<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSH Client</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@4.18.0/css/xterm.css" />
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@4.18.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.5.0/lib/xterm-addon-fit.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <style>
        .mfa-status-text {
            font-size: 0.85em;
            font-weight: 500;
            margin-top: 4px;
            transition: color 0.3s ease;
        }
        
        .confirmation-modal .modal-content {
            max-width: 500px;
        }
        
        .confirmation-content {
            padding: 10px 0;
        }
        
        .btn-danger {
            background-color: #f44336;
            color: white;
            border: none;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        .form-help {
            font-size: 0.85em;
            color: #666;
            margin-top: 4px;
        }
        
        .mfa-setup-modal .modal-content {
            max-width: 600px;
        }
        
        .mfa-setup-steps {
            margin: 20px 0;
        }
        
        .mfa-setup-steps .step {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .mfa-setup-steps .step:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .mfa-setup-steps h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .qr-code-container {
            text-align: center;
            margin: 15px 0;
        }
        
        .qr-code {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: white;
            max-width: 200px;
        }
        
        .code-input-group {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 15px 0;
        }
        
        .code-input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: #f9f9f9;
        }
        
        .code-input:focus {
            border-color: #007bff;
            background: white;
            outline: none;
        }
        
        .backup-codes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 15px 0;
            padding: 15px;
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .backup-code {
            font-family: monospace;
            font-size: 0.9em;
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
            padding: 10px 8px;
            border-radius: 6px;
            text-align: center;
            border: 2px solid #dee2e6;
            letter-spacing: 1px;
        }
        
        .backup-code:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .backup-codes-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .download-backup-btn {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="header">
                <input type="text" class="search-box" id="search-box" placeholder="Find a host or ssh user@hostname...">
                <div class="view-controls">
                    <button class="view-btn active" id="grid-view" title="Grid View">⊞</button>
                    <button class="view-btn" id="list-view" title="List View">☰</button>
                </div>
                <div class="header-buttons">
                    <button class="btn" onclick="openSettingsModal()" title="Settings">⚙</button>
                    <button class="btn btn-primary" onclick="openCreateModal()">+ NEW HOST</button>
                </div>
            </div>

            <div class="section-title">Hosts</div>
            <div class="hosts-container" id="client-list"></div>
        </div>

        <!-- Terminal View with Tabs -->
        <div class="terminal-view" id="terminal-view">
            <div class="tab-bar" id="tab-bar">
                <div class="back-btn" onclick="backToList()">
                    <span class="back-icon">←</span>
                    <span>Hosts</span>
                </div>
            </div>
            <div class="terminal-container" id="terminal-container"></div>
        </div>
    </div>

    <!-- Settings Icon -->
    <button class="settings-icon" onclick="toggleThemePanel()">⚙</button>

    <!-- Theme Panel -->
    <div class="theme-panel" id="theme-panel">
        <div class="theme-panel-header">
            <div class="theme-panel-title">Terminal Settings</div>
            <button class="close-btn" onclick="toggleThemePanel()">×</button>
        </div>
        <div class="theme-section">
            <div class="theme-section-title">Themes</div>
            <div class="theme-grid" id="theme-grid"></div>
        </div>
    </div>

    <!-- Create Client Modal -->
    <div class="modal" id="create-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeCreateModal()">×</button>
            <div class="modal-header" id="modal-header-title">Create SSH Client</div>
            <form id="create-client-form">
                <input type="hidden" id="client-id" name="client_id">
                <div class="form-group">
                    <label for="label">Label</label>
                    <input type="text" id="label" name="label">
                </div>
                <div class="form-group">
                    <label for="host">Host</label>
                    <input type="text" id="host" name="host" required>
                </div>
                <div class="form-group">
                    <label for="port">Port</label>
                    <input type="number" id="port" name="port" value="22" required>
                </div>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password">
                </div>
                <div class="form-group">
                    <label for="private_key">Private Key</label>
                    <textarea id="private_key" name="private_key"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeCreateModal()">Cancel</button>
                    <button type="button" class="btn" onclick="deleteCurrentClient()" id="delete-btn" style="background: #d84f76; display: none;">Delete</button>
                    <button type="submit" class="btn btn-primary" id="submit-btn">Create</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal settings-modal" id="settings-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeSettingsModal()">×</button>
            <div class="modal-header">Settings</div>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchSettingsTab('security')">Security</button>
                <button class="settings-tab" onclick="switchSettingsTab('terminal')">Terminal</button>
                <button class="settings-tab" onclick="switchSettingsTab('general')">General</button>
            </div>

            <!-- Security Settings -->
            <div class="settings-content active" id="security-settings">
                <div class="settings-section">
                    <div class="settings-section-title">Multi-Factor Authentication</div>
                    <div class="settings-section-description">
                        Add an extra layer of security to your account by enabling two-factor authentication.
                    </div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Enable MFA</h4>
                            <p>Require a second form of authentication when signing in</p>
                            <div class="mfa-status-text" id="mfa-status-text">Status: Checking...</div>
                        </div>
                        <div class="toggle-switch" id="mfa-toggle" onclick="toggleMFA()">
                        </div>
                    </div>

                    <div id="mfa-methods-section" style="display: none;">
                        <div class="mfa-methods-list">
                            <div class="mfa-method-item" id="authenticator-method">
                                <div style="display: flex; align-items: center;">
                                    <span class="mfa-method-icon">📱</span>
                                    <div class="mfa-method-details">
                                        <h5>Authenticator App</h5>
                                        <p>Use Google Authenticator, Authy, or similar apps</p>
                                    </div>
                                </div>
                                <div class="mfa-method-actions">
                                    <button class="btn btn-small btn-primary" onclick="setupAuthenticator()">Setup</button>
                                </div>
                            </div>

                            <div class="mfa-method-item" id="sms-method">
                                <div style="display: flex; align-items: center;">
                                    <span class="mfa-method-icon">💬</span>
                                    <div class="mfa-method-details">
                                        <h5>SMS Text Message</h5>
                                        <p>Receive codes via text message</p>
                                    </div>
                                </div>
                                <div class="mfa-method-actions">
                                    <button class="btn btn-small btn-primary" onclick="setupSMS()">Setup</button>
                                </div>
                            </div>

                            <div class="mfa-method-item" id="email-method">
                                <div style="display: flex; align-items: center;">
                                    <span class="mfa-method-icon">📧</span>
                                    <div class="mfa-method-details">
                                        <h5>Email Verification</h5>
                                        <p>Receive codes via email</p>
                                    </div>
                                </div>
                                <div class="mfa-method-actions">
                                    <button class="btn btn-small btn-primary" onclick="setupEmail()">Setup</button>
                                </div>
                            </div>

                            <div class="mfa-method-item" id="backup-codes-method">
                                <div style="display: flex; align-items: center;">
                                    <span class="mfa-method-icon">🔑</span>
                                    <div class="mfa-method-details">
                                        <h5>Backup Codes</h5>
                                        <p>One-time use codes for account recovery</p>
                                    </div>
                                </div>
                                <div class="mfa-method-actions">
                                    <button class="btn btn-small" onclick="generateBackupCodes()">Generate</button>
                                    <button class="btn btn-small" onclick="viewBackupCodes()" style="display: none;" id="view-backup-codes">View</button>
                                </div>
                            </div>
                        </div>

                        <div id="backup-codes-display" style="display: none; margin-top: 20px;">
                            <div class="settings-section-title">Your Backup Codes</div>
                            <div class="settings-section-description">
                                Save these codes in a safe place. Each code can only be used once.
                            </div>
                            <div class="backup-codes-grid" id="backup-codes-grid">
                                <!-- Backup codes will be generated here -->
                            </div>
                            <div style="margin-top: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-small" onclick="downloadBackupCodes()">Download</button>
                                <button class="btn btn-small" onclick="printBackupCodes()">Print</button>
                                <button class="btn btn-small" onclick="regenerateBackupCodes()">Regenerate</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Account Management</div>
                    <div class="settings-section-description">
                        Manage your account credentials and personal information.
                    </div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Change Email</h4>
                            <p>Update your email address for account security</p>
                        </div>
                        <button class="btn btn-small" onclick="openChangeEmailModal()">Change</button>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Change Password</h4>
                            <p>Update your password to keep your account secure</p>
                        </div>
                        <button class="btn btn-small" onclick="openChangePasswordModal()">Change</button>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Sign Out</h4>
                            <p>Sign out of your account and clear all session data</p>
                        </div>
                        <button class="btn btn-small btn-danger" onclick="logout()">Sign Out</button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Session Management</div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Auto Logout</h4>
                            <p>Automatically sign out after 30 minutes of inactivity</p>
                        </div>
                        <div class="toggle-switch active" id="auto-logout-toggle" onclick="toggleAutoLogout()">
                        </div>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Remember Device</h4>
                            <p>Skip MFA on this device for 30 days</p>
                        </div>
                        <div class="toggle-switch" id="remember-device-toggle" onclick="toggleRememberDevice()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terminal Settings -->
            <div class="settings-content" id="terminal-settings">
                <div class="settings-section">
                    <div class="settings-section-title">Terminal Appearance</div>
                    <div class="settings-section-description">
                        Customize the look and feel of your terminal sessions.
                    </div>
                    
                    <div class="theme-section">
                        <div class="theme-section-title">Themes</div>
                        <div class="theme-grid" id="settings-theme-grid"></div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Terminal Behavior</div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Auto Reconnect</h4>
                            <p>Automatically reconnect when connection is lost</p>
                        </div>
                        <div class="toggle-switch active" id="auto-reconnect-toggle" onclick="toggleAutoReconnect()">
                        </div>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Bell Sound</h4>
                            <p>Play a sound when the terminal bell is triggered</p>
                        </div>
                        <div class="toggle-switch" id="bell-sound-toggle" onclick="toggleBellSound()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- General Settings -->
            <div class="settings-content" id="general-settings">
                <div class="settings-section">
                    <div class="settings-section-title">Application Preferences</div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Dark Mode</h4>
                            <p>Use dark theme for the application interface</p>
                        </div>
                        <div class="toggle-switch active" id="dark-mode-toggle" onclick="toggleDarkMode()">
                        </div>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Notifications</h4>
                            <p>Show browser notifications for connection events</p>
                        </div>
                        <div class="toggle-switch active" id="notifications-toggle" onclick="toggleNotifications()">
                        </div>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Auto Save</h4>
                            <p>Automatically save host configurations</p>
                        </div>
                        <div class="toggle-switch active" id="auto-save-toggle" onclick="toggleAutoSave()">
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">Data & Storage</div>
                    
                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Clear Session Data</h4>
                            <p>Remove all saved session data and preferences</p>
                        </div>
                        <button class="btn btn-danger btn-small" onclick="clearSessionData()">Clear Data</button>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Export Settings</h4>
                            <p>Download your settings and host configurations</p>
                        </div>
                        <button class="btn btn-small" onclick="exportSettings()">Export</button>
                    </div>

                    <div class="settings-option">
                        <div class="settings-option-info">
                            <h4>Import Settings</h4>
                            <p>Restore settings from a previously exported file</p>
                        </div>
                        <button class="btn btn-small" onclick="importSettings()">Import</button>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn" onclick="closeSettingsModal()">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Change Email Modal -->
    <div class="modal change-modal" id="change-email-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeChangeEmailModal()">×</button>
            <div class="modal-header">Change Email Address</div>
            
            <div class="current-info">
                Current email: <strong id="currentEmailDisplay">user@example.com</strong>
            </div>

            <form id="change-email-form">
                <div class="form-group">
                    <label for="current-password-email">Current Password</label>
                    <input type="password" id="current-password-email" name="currentPassword" required>
                </div>

                <div class="form-group">
                    <label for="new-email">New Email Address</label>
                    <input type="email" id="new-email" name="newEmail" required>
                </div>

                <div class="form-group">
                    <label for="confirm-email">Confirm New Email</label>
                    <input type="email" id="confirm-email" name="confirmEmail" required>
                </div>

                <div class="form-note">
                    A verification email will be sent to your new address to confirm the change.
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeChangeEmailModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Email</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal change-modal" id="change-password-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeChangePasswordModal()">×</button>
            <div class="modal-header">Change Password</div>

            <form id="change-password-form">
                <div class="form-group">
                    <label for="current-password-change">Current Password</label>
                    <input type="password" id="current-password-change" name="currentPassword" required>
                </div>

                <div class="form-group">
                    <label for="new-password-change">New Password</label>
                    <input type="password" id="new-password-change" name="newPassword" required>
                    <div class="strength-meter">
                        <div class="strength-bar">
                            <div class="strength-fill" id="password-strength-fill"></div>
                        </div>
                        <div class="strength-text" id="password-strength-text">Password strength: Weak</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="confirm-password-change">Confirm New Password</label>
                    <input type="password" id="confirm-password-change" name="confirmPassword" required>
                </div>

                <div class="password-requirements">
                    <div class="requirements-title">Password requirements:</div>
                    <div class="requirement" id="length-req">• At least 8 characters</div>
                    <div class="requirement" id="uppercase-req">• One uppercase letter</div>
                    <div class="requirement" id="lowercase-req">• One lowercase letter</div>
                    <div class="requirement" id="number-req">• One number</div>
                    <div class="requirement" id="special-req">• One special character</div>
                </div>

                <div class="form-note">
                    You'll be signed out from all devices after changing your password for security.
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeChangePasswordModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Password</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MFA Disable Confirmation Modal -->
    <div class="modal confirmation-modal" id="mfa-disable-confirmation-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeMFADisableConfirmationModal()">×</button>
            <div class="modal-header">Disable Multi-Factor Authentication</div>
            
            <div class="confirmation-content">
                <div class="warning-icon" style="font-size: 48px; color: #ff9800; text-align: center; margin-bottom: 20px;">⚠️</div>
                <p style="text-align: center; margin-bottom: 20px;">
                    <strong>Are you sure you want to disable Multi-Factor Authentication?</strong>
                </p>
                <p style="text-align: center; margin-bottom: 20px; color: #f44336;">
                    This will make your account less secure and more vulnerable to unauthorized access.
                </p>
                <ul style="margin: 20px 0; padding-left: 20px;">
                    <li>You will need to provide your password</li>
                    <li>You will need your current MFA code</li>
                    <li>This action cannot be undone without re-enabling MFA</li>
                </ul>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn" onclick="closeMFADisableConfirmationModal()">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="showMFADisableForm()">Continue to Disable</button>
            </div>
        </div>
    </div>

    <!-- MFA Disable Form Modal -->
    <div class="modal" id="mfa-disable-form-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeMFADisableFormModal()">×</button>
            <div class="modal-header">Verify Identity to Disable MFA</div>
            
            <form id="mfa-disable-form">
                <div class="form-group">
                    <label for="mfa-disable-password">Current Password</label>
                    <input type="password" id="mfa-disable-password" name="password" required>
                </div>

                <div class="form-group">
                    <label for="mfa-disable-code">MFA Code</label>
                    <input type="text" id="mfa-disable-code" name="mfaCode" placeholder="Enter 6-digit code" maxlength="6" required>
                    <div class="form-help">Enter the 6-digit code from your authenticator app</div>
                </div>

                <div class="form-note" style="color: #f44336;">
                    ⚠️ Warning: Disabling MFA reduces your account security significantly.
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn" onclick="closeMFADisableFormModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">Disable MFA</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/index.js"></script>
</body>
</html>